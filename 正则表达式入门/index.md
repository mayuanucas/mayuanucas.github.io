# 正则表达式入门


正则表达式，英文是 Regular Expression，简称 RE。顾名思义，正则其实就是一种描述文本内容组成规律的表示方式。在编程语言中，正则常常用来简化文本处理的逻辑。在 Linux 命令中，它也可以帮助我们轻松地查找或编辑文件的内容，甚至实现整个文件夹中所有文件的内容替换，比如 grep、egrep、sed、awk、vim 等。另外，在各种文本编辑器中，比如 Atom，Sublime Text 或 VS Code 等，在查找或替换的时候也会使用到它。总之，正则是无处不在的，已经渗透到了日常工作的方方面面。

<!-- more -->

# 前言

简单来说，正则是一个非常强大的文本处理工具，它的应用极其广泛。我们可以利用它来校验数据的有效性，比如用户输入的手机号是不是符合规则；也可以从文本中提取想要的内容，比如从网页中抽取数据；还可以用来做文本内容替换，从而得到我们想要的内容。通过它的功能和分布的广泛你也能看出来，正则是一个非常值得花时间和精力好好学习的基本技能。之前需要花几十分钟才能搞定的事情，可能用正则很快就搞定了；之前不能解决的问题，通过系统地学习正则后，可能发现也能轻松解决了。还在犹豫什么？赶紧继续阅读吧！

# 元字符

元字符就是指那些在正则表达式中具有特殊意义的专用字符，元字符是构成正则表达式的基本元件，正则就是由一系列的元字符组成的。

## 元字符的分类

元字符大致分成这几类：表示单个特殊字符的，表示空白符的，表示某个范围的，表示次数的量词，另外还有表示断言的，我们可以把它理解成边界限定。

![元字符分类](/正则表达式入门/yuanzifufenlei.png)

### 特殊单字符

| .    | 任意字符(换行除外)     |      |                          |
| ---- | ---------------------- | ---- | ------------------------ |
| \d   | 任意数字               | \D   | 任意非数字               |
| \w   | 任意字母、数字、下划线 | \W   | 任意非字母、数字、下划线 |
| \s   | 任意空白符             | \S   | 任意非空白符             |

![特殊单字符](/正则表达式入门/tsdzf.png)

### 空白符

除了特殊单字符外，你在处理文本的时候肯定还会遇到空格、换行等空白符。其实在写代码的时候也会经常用到，换行符 \n，TAB 制表符 \t 等。

有编程经验的程序员肯定都知道，不同的系统在每行文本结束位置默认的“换行”会有区别。比如在 Windows 里是 \r\n，在 Linux 和 MacOS 中是 \n。在正则中，也是类似于 \n 或 \r 等方式来表示空白符号，只要记住它们就行了。平时使用正则，大部分场景使用 \s 就可以满足需求，\s 代表任意单个空白符号。 \s 能匹配上各种空白符号，也可以匹配上空格。换行有专门的表示方式，在正则中，空格就是用普通的字符英文的空格来表示。

![空白符](/正则表达式入门/kbf.png)

### 量词

在正则中，英文的星号 (*) 代表出现 0 到多次，加号 (+) 代表 1 到多次，问号 (?) 代表 0 到 1 次，{m,n}代表 m 到 n 次。

![量词](/正则表达式入门/lc.png)

### 范围

在正则表达式中，表示范围的符号有四个分类：

![范围](/正则表达式入门/fanwei.png)

首先是管道符号，用它来隔开多个正则，表示满足其中任意一个就行，比如 ab|bc 能匹配上 ab，也能匹配上 bc，在正则有多种情况时，这个非常有用。中括号[]代表多选一，可以表示里面的任意单个字符，所以任意元音字母可以用 [aeiou] 来表示。另外，中括号中，我们还可以用中划线表示范围，比如 [a-z] 可以表示所有小写字母。如果中括号第一个是脱字符（^），那么就表示非，表达的是不能是里面的任何单个元素。

# 量词与贪婪

## 贪婪匹配

在正则中，表示次数的量词默认是贪婪的，在贪婪模式下，会尝试尽可能最大长度去匹配。**贪婪模式的特点就是尽可能进行最大长度匹配。**

例如：在字符串 aaabb 中使用正则 a* 的匹配过程。a* 在匹配开头的 a 时，会尝试尽量匹配更多的 a，直到第一个字母 b 不满足要求为止，匹配上三个 a，后面每次匹配时都得到了空字符串。

![贪婪匹配](/正则表达式入门/tlpp.png)

## 非贪婪匹配

非贪婪模式会尽可能短地去匹配，在量词后面加上英文的问号 (?)，正则就变成了 a*?。

![非贪婪匹配](/正则表达式入门/ftl01.png)

![非贪婪匹配](/正则表达式入门/ftl02.png)

## 独占模式

独占模式和贪婪模式很像，独占模式会尽可能多地去匹配，如果匹配失败就结束，不会进行回溯，这样的话就比较节省时间。具体的方法就是在量词后面加上加号（+）。

独占模式性能比较好，可以节约匹配的时间和 CPU 资源，但有些情况下并不能满足需求，要想使用这个模式还要看具体需求（比如我们接下来要讲的案例），另外还得看你当前使用的语言或库的支持程度。

# 分组与引用

## 分组与编号

括号在正则中可以用于分组，被括号括起来的部分“子表达式”会被保存成一个子组。分组和编号的规则，用一句话来说就是，第几个括号就是第几个分组。以时间格式 2020-05-10 20:23:05为例，假设想要使用正则提取出里面的日期和时间。

![分组示例](/正则表达式入门/fzybh.png)

可以写出如图所示的正则，将日期和时间都括号括起来。这个正则中一共有两个分组，日期是第 1 个，时间是第 2 个。

## 不保存子组

在括号里面的会保存成子组，但有些情况下，你可能只想用括号将某些部分看成一个整体，后续不用再用它，类似这种情况，在实际使用时，是没必要保存子组的。这时可以在括号里面使用 ?: 不保存子组。由于子组变少了，正则性能会更好，在子组计数时也更不容易出错。那什么是不保存子组呢？可以理解成，括号只用于归组，把某个部分当成“单个元素”，不分配编号，后面不会再进行这部分的引用。

![不保存子组](/正则表达式入门/nozizu.png)

## 括号嵌套

要看某个括号里面的内容是第几个分组怎么办？不要担心，其实方法很简单，我们只需要数左括号（开括号）是第几个，就可以确定是第几个子组。

![括号嵌套](/正则表达式入门/kuohaoqiantao.png)

## 命名分组

命名分组的格式为(?P<分组名>正则)，例如 Django的路由中，命名分组示例如下：

```shell
url(r'^profile/(?P<username>\w+)/$', view_func)
```

## 分组引用

大部分情况下，我们就可以使用 “反斜扛 + 编号”，即 \number 的方式来进行引用，而 JavaScript 中是通过“\$”编号来引用，如“\$1”。

![分组引用](/正则表达式入门/fenzu.png)


# 匹配模式

## 不区分大小写模式

把模式修饰符放在整个正则前面时，就表示整个正则表达式都是不区分大小写的。模式修饰符是通过 (? 模式标识) 的方式来表示的。 我们只需要把模式修饰符放在对应的正则前，就可以使用指定的模式了。在不区分大小写模式中，由于不分大小写的英文是 Case-Insensitive，那么对应的模式标识就是 I 的小写字母 i，所以不区分大小写的 cat 就可以写成 (?i)cat。

![不区分大小写](/正则表达式入门/dxx01.png)

也可以用它来尝试匹配两个连续出现的 cat，如下图所示，你会发现，即便是第一个 cat 和第二个 cat 大小写不一致，也可以匹配上。

![不区分大小写](/正则表达式入门/dxx02.png)

如果我们想要前面匹配上的结果，和第二次重复时的大小写一致，那该怎么做呢？我们只需要用括号把修饰符和正则 cat 部分括起来，加括号相当于作用范围的限定，让不区分大小写只作用于这个括号里的内容。

![不区分大小写](/正则表达式入门/dxx03.png)

通过修饰符指定匹配模式的方式，在大部分编程语言中都是可以直接使用的，但在 JS 中我们需要使用 /regex/i 来指定匹配模式。在编程语言中通常会提供一些预定义的常量，来进行匹配模式的指定。比如 Python 中可以使用 re.IGNORECASE 或 re.I ，来传入正则函数中来表示不区分大小写。

```python
import re
re.findall(r"cat", "CAT Cat cat", re.IGNORECASE)
# 输出结果为：
['CAT', 'Cat', 'cat']
```

总结一下不区分大小写模式的要点：

1. 不区分大小写模式的指定方式，使用模式修饰符 (?i)；
2. 修饰符如果在括号内，作用范围是这个括号内的正则，而不是整个正则；
3. 使用编程语言时可以使用预定义好的常量来指定匹配模式。

## 点号通配模式（Dot All）

英文的点（.）可以匹配上任何符号，但不能匹配换行。当我们需要匹配真正的“任意”符号的时候，可以使用 [\s\S] 或 [\d\D] 或 [\w\W] 等。

但是这么写不够简洁自然，所以正则中提供了一种模式，让英文的点（.）可以匹配上包括换行的任何字符。

这个模式就是点号通配模式，有很多地方把它称作单行匹配模式，但这么说容易造成误解，毕竟它与多行匹配模式没有联系，因此在这里统一用更容易理解的“点号通配模式”。单行的英文表示是 Single Line，单行模式对应的修饰符是 (?s)，这里选择用 the cat 来举一个点号通配模式的例子。如下图所示：

![点号通配模式](/正则表达式入门/dh.png)

## 多行匹配模式（Multiline）

通常情况下，\^ 匹配整个字符串的开头，\$  匹配整个字符串的结尾。多行匹配模式改变的就是 \ ^ 和 \$ 的匹配行为。

![多行匹配模型](/正则表达式入门/duohang01.png)

多行模式的作用在于，使 \^ 和 \$ 能匹配上每行的开头或结尾，我们可以使用模式修饰符号 (?m) 来指定这个模式。

![多行匹配模型](/正则表达式入门/duohang02.png)

## 注释模式（Comment）

在写代码的时候，通常会在一些关键的地方加上注释，让代码更易于理解。很多语言也支持在正则中添加注释，让正则更容易阅读和维护，这就是正则的注释模式。正则中注释模式是使用 (?#comment) 来表示。例如：

```shell
(\w+)(?#word) \1(?#word repeat again)
```

# 断言

## 单词边界

在正则中使用\b 来表示单词的边界。 \b 中的 b 可以理解为是边界（Boundary）这个单词的首字母。

![单词边界](/正则表达式入门/dcbj.png)

## 行的开始或结束

和单词的边界类似，在正则中还有文本每行的开始和结束，如果我们要求匹配的内容要出现在一行文本开头或结尾，就可以使用 ^ 和 $ 来进行位置界定。

![换行符](/正则表达式入门/huanhang.png)

## 环视

左尖括号代表看左边，没有尖括号是看右边，感叹号是非的意思。

![环视记忆](/正则表达式入门/huanshi01.png)

因此，针对邮编的问题，就可以写成左边不是数字，右边也不是数字的 6 位数的正则。即

```html
(?<!\d)[1-9]\d{5}(?!\d)
```

例如：用正则分组引用来实现替换重复出现的单词。

![单词替换](/正则表达式入门/lizi.png)
